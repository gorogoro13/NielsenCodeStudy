\documentclass[11pt,a4j,fleqn]{jarticle}  

%\usepackage[dvips]{graphicx}[dvipdfmx]
\usepackage[dvipdfmx]{graphicx}
%自動的に番号を振るマクロ 
\newcounter{apart}

\begin{document}

\title{
	\textbf{\Large  Michael Nielsen のニューラルネットワーク\\
	\bigskip
	「逆伝播法」の数式とソースコード}\\
	\bigskip
}

\bigskip
\bigskip
\author{なかじま　ひでき}
\date{\today}
\maketitle
%\renewcommand{\theapart}[1][]{\refstepcounter{apart}#1[Part{\theapart]：}
\renewcommand{\theapart}{\Alph{apart}}
\setcounter{apart}{1}

\textbf{\Large \theapart ：理論}
\refstepcounter{apart}

\section{コスト関数}
「逆伝播」はどのような誤差関数を採用するかが出発点になる。多クラス分類問題には二乗誤差関数を用いる（さらに学習精度を高めるためには交差エントロピー関数を用いるが、これは後回し）。
\subsection{定義}
\begin{eqnarray}  C(w,b) \equiv
  \frac{1}{2n} \sum_x \| y(x) - a\|^2. \hspace{5mm}・・・「コスト関数 C 」と命名する。\nonumber \\
  実際に計算できるのは1つの訓練例xに対する誤差　\frac{1}{2} \sum_j (y_j-a^L_j)^2.　\nonumber 
\end{eqnarray}
　  w はネットワーク中の全ての重み、 b は全バイアス、 n は訓練入力の総数、y(x)は、入力xの時の目標出力、a は入力が x の時にネットワークから出力されるベクトル、和は全ての訓練入力 x を表す。\\
　この関数は、訓練入力 x の総和について表されている点が他の誤差関数と比べて特殊である。
\subsection{コスト関数の条件}
コスト関数の評価を通して逆伝播のコードを実装するにはいくつかの条件がある。実際に計算できるのはネットワーク全体ではなく（もしできたとしてもとてつもない計算負荷になる）、個々のニューロンだからだ。\\
定義から
\begin{itemize}
\item 総和（ネットワークの誤差）の中の全項目（ニューロンにおける誤差）が非負の値で示せること
\item C(w,b)$\simeq$0 の時は全訓練入力において 正解y(x) とテスト結果の出力aがほぼ等しくなる
\item 滑らかな関数であること（結局のところ分類の正解数を上げることが目的だが、分類の正解数がネットワーク中の重みとバイアスの滑らかな関数にならないのでコスト関数を導出する）
\end{itemize}
\subsection{コスト関数に(さらに)必要な2つの仮定}
・コスト関数は個々の訓練例xに対するコスト関数$C_x$の平均 $C = \frac{1}{n} \sum_x C_x$で書かれている。1つの訓練例に対するコスト関数を$C_x = \frac{1}{2} \|y-a^L \|^2$とすれば良いので 2乗コスト関数ではこの仮定が成立している。この仮定が必要となる理由は、逆伝播によって計算できるのは個々の訓練例に対する偏微分$\partial C_x / \partial w$、$\partial C_x / \partial b$だからです。\\
・コスト関数はニューラルネットワークの出力の関数で書かれている。\\
2乗コスト関数では1つの訓練例xに対する誤差は以下のように書ける。\\
\begin{eqnarray}
  C = C(a^L) = \frac{1}{2} \|y-a^L\|^2 = \frac{1}{2} \sum_j (y_j-a^L_j)^2. \hspace{10mm} （27）\nonumber
\end{eqnarray}
----(以下　Chapter1の内容)--------------------------------------------------------------------------------\\
C($V_1$, $V_2$)としたときののグラフは次のようになる。
    \begin{center}
        \includegraphics[clip,width=8.5cm]{./valley.png} \\
        %\hspace{1.0cm}【C($V_1$, $V_2$)のグラフ】
    \end{center}
 $v_1$ 方向に微小な量 $\Delta v_1$ 、 v2 方向に微小な量 $\Delta v_2$ だけボールを動かした時に何が起こるか考えてみましょう。計算の結果、 Cの微小変化$\Delta C$は次のようになります:
\begin{eqnarray}
  \Delta C \approx \frac{\partial C}{\partial v_1} \Delta v_1 +
  \frac{\partial C}{\partial v_2} \Delta v_2.
  \hspace{1.0cm} (２変数式の偏微分、３次元曲面上の近似解)
\end{eqnarray}
\\
{\large 問：『$ \Delta{C}$が負の値; すなわち、ボールが谷を転がり降りていくような $\Delta{V_1}$ と $\Delta{V_2}$ を選ぶ方法を見つけましょう。』}\\
 $\Delta v \equiv (\Delta v_1, \Delta v_2)^T$ と定義して（教科書的なベクトルの行列表現に習って縦ベクトルにします）
\begin{eqnarray}
  \nabla C \equiv \left( \frac{\partial C}{\partial v_1},
  \frac{\partial C}{\partial v_2} \right)^T.
\end{eqnarray}
これまでの式からベクトル表現を使えば、
\begin{eqnarray}
  \Delta C \approx \nabla C \cdot \Delta v
\end{eqnarray}
η は小さい正のパラメータ(学習率として知られるもの)として、次の仮定を与えれば\\
\begin{eqnarray}
  \Delta v = -\eta \nabla C,
\end{eqnarray}

等式(9) から\\
\hspace{1.0cm} $ \Delta C \approx \nabla C \cdot \Delta v = \nabla C \cdot -\eta \nabla C =  -\eta \|\nabla C\|^2$
\hspace{1.0cm} ∴　 $\Delta C \approx -\eta \|\nabla C\|^2$ \\
$\|
\nabla C \|^2 \geq 0$ であることから $\Delta C \leq 0$ が成り立つため(10)の前提に従い vを変更する限り Cは常に減少し、決して増加しないことが保証されます(勿論(9) の等式が近似する限りです)。\\
  Cの微小変化$\Delta C$の符号を保証するために2乗の項を導き出した副産物が学習率$\eta$の意味を持ち他の副産物は発生しない完璧な変形です。\\
私たちは等式(10)を使い $\Delta v$の値を計算し、ボールの位置を v から次のように動かすのです:\\
\begin{eqnarray}
  v \rightarrow v' = v -\eta \nabla C.
\end{eqnarray}


勾配降下法の Cがちょうど二つの変数の関数である場合を説明しました。しかし、実際には、 Cが複数の関数であっても何も問題はありません。ここで Cが m個の変数 $v_1$,…,$v_m$の関数であると仮定します。この時、微小な変化 $\Delta v$ = (Δ$v_1$,…,Δ$v_m$)$^T$によってもたらされる Cの変化 $\Delta C$は\\
ｍ次元であったとしても同じ式で表すことができる。\\
\begin{itemize}
 \item  Cの微小変化\hspace{0.5cm} $ \Delta C \approx \nabla C \cdot \Delta v$
 \item  勾配 \hspace{0.5cm}  $\nabla C \equiv \left(\frac{\partial C}{\partial v_1}, \ldots \frac{\partial C}{\partial v_m}\right)^T$
 \item  学習率を仮定(あるいは２乗の項を導くために) \hspace{0.5cm} $\Delta v = -\eta \nabla C$
 \item  最小値への更新\hspace{0.5cm} $v \rightarrow v' = v-\eta \nabla C$
\end{itemize}
------------------------------------------------------------------------------------------------------\\
\newpage
\textbf{\Large \theapart ：コード}
\refstepcounter{apart}
\begin{verbatim}
 Nielsenの逆伝播アルゴリズムのソースコード "network.py"に定義されている関数backprop(self, x, y):のデバッグトレース

１．　ソースコード（関数定義部分の抜粋。コメント行は削除。）
    def backprop(self, x, y):
        nabla_b = [np.zeros(b.shape) for b in self.biases]
        nabla_w = [np.zeros(w.shape) for w in self.weights]
        # feedforward
        activation = x
        activations = [x] # list to store all the activations, layer by layer
        zs = [] # list to store all the z vectors, layer by layer
        for b, w in zip(self.biases, self.weights):
            z = np.dot(w, activation)+b
            zs.append(z)
            activation = sigmoid(z)
            activations.append(activation)
        # backward pass
        delta = self.cost_derivative(activations[-1], y) * \
            sigmoid_prime(zs[-1])
        nabla_b[-1] = delta
        nabla_w[-1] = np.dot(delta, activations[-2].transpose())

        for l in xrange(2, self.num_layers):
            z = zs[-l]
            sp = sigmoid_prime(z)
            delta = np.dot(self.weights[-l+1].transpose(), delta) * sp
            nabla_b[-l] = delta
            nabla_w[-l] = np.dot(delta, activations[-l-1].transpose())
        return (nabla_b, nabla_w)

２．　出力層の逆伝播
        nabla_b = [np.zeros(b.shape) for b in self.biases]
        nabla_w = [np.zeros(w.shape) for w in self.weights]
        # feedforward
        activation = x
        activations = [x] # list to store all the activations, layer by layer
        zs = [] # list to store all the z vectors, layer by layer
        for b, w in zip(self.biases, self.weights):
            z = np.dot(w, activation)+b
            zs.append(z)
            activation = sigmoid(z)
            activations.append(activation)
        # backward pass　出力層
        delta = self.cost_derivative(activations[-1], y) * \
            sigmoid_prime(zs[-1])
        nabla_b[-1] = delta
        nabla_w[-1] = np.dot(delta, activations[-2].transpose())


 (1) バイアス修正量　nabla_b・・・ list[nd_tuple(30,1), nd_tuple(10,1)]
[array([[ 0.],
       [ 30個]])　, 
array([[ 0.],
       [ 10個]])]

 (2) 重み修正量　nabla_w・・・ list[ nd_tuple(30, 784), nd_tuple(10, 30) ]
[array([[ 0.,  ...,784個],
       [30個...,784個]]), 
array([[ 0.,  ...,30個],
       [ 10個,  ...,30個]])]
       
（３） zs (出力直前層の重み付き出力)
[array([[ -4.06792851],
       [ 13.83035127],
       [-11.39045925],
       [ -2.1877467 ],
       [  1.71250302],
       [  1.29524733],
       [  0.23624495],
       [ -8.10933187],
       [-11.491804  ],
       [  0.53723592],
       [  0.53857708],
       [ -5.38366389],
       [  3.58540503],
       [  3.11275071],
       [-20.00966085],
       [ 17.99690408],
       [  3.3473783 ],
       [  8.66680108],
       [ 19.2220285 ],
       [ -7.9302986 ],
       [ -0.68391454],
       [ 13.27240062],
       [ 18.7771117 ],
       [ -1.65317534],
       [ -0.82577125],
       [  6.8699141 ],
       [-10.51787361],
       [ -7.42705103],
       [ -3.37288183],
       [  9.26421692]])]
（４） activations
[array([[ 0.984576...  ],
	|
       [784個        ]], dtype=float32), 
array([[  9.99640765e-01],
       　　｜
       [ 30個　　　　　]])]



（５） delta（＝nabla_b）　(出力層の個々のニューロンの誤差)
delta = self.cost_derivative(activations[-1], y) *  sigmoid_prime(zs[-1]) 
[[  1.28253211e-05]
 [  1.46060093e-01]
 [ -5.09951759e-03]
 [  2.69445151e-04]
 [  3.57844097e-02]
 [  5.95821542e-02]
 [  2.37592100e-02]
 [  1.08533171e-01]
 [  6.63908743e-04]
 [  6.85595516e-03]]
nabla_b[-1] = delta # 式（BP1)　baias-voctor の偏微分値

（６） nabla_w
nabla_w[-1] = np.dot(delta, activations[-2].transpose()) # 重み付き入力wの
tmp = activations[-2].transpose()
print tmp
[[  9.98564175e-01   9.49081478e-02   9.98311660e-01   1.15638278e-03
    9.99912083e-01   9.98938584e-01   5.51497536e-02   9.89065706e-01
    9.56589936e-01   9.00461334e-04   7.59693269e-01   9.98862475e-01
    1.45314383e-03   9.66440875e-01   9.99999129e-01   1.35852463e-04
    9.99861283e-01   9.15797861e-01   9.99998350e-01   1.23326967e-01
    6.64269432e-01   3.66655003e-03   4.78511591e-01   1.58593370e-01
    8.38284264e-07   9.98329014e-01   9.99576112e-01   1.93122526e-03
    9.87612831e-01   9.99515624e-01]]

 nabla_w
[array([[ 0.,  ...,784個],
       　｜　　..., 
       [30個...,784個]])), 
array([[ -1.19532475e-10,  -6.18730756e-07,  -1.99043846e-04,
         -7.29140125e-05,  -1.03304536e-05,  -3.32825533e-08,
         -9.21118261e-02,  -9.32428587e-02,  -9.61036987e-02,
         -9.61150146e-02,  -9.60368726e-02,  -3.24272960e-07,
         -9.60657931e-02,  -1.44370213e-02,  -9.60511167e-02,
         -9.01427665e-10,  -5.06461865e-04,  -5.11145373e-07,
         -2.38446065e-03,  -9.40622772e-02,  -8.73073103e-05,
         -9.57277346e-02,  -8.85066315e-06,  -9.61117856e-02,
         -9.31959973e-02,  -9.54709632e-05,  -9.51484194e-02,
         -9.60732128e-02,  -2.29045530e-07,  -4.09067814e-07],
       [  5.68466854e-12,   2.94253028e-08,   9.46603250e-06,
          3.46760990e-06,   4.91290796e-07,   1.58283583e-09,
          4.38061038e-03,   4.43439949e-03,   4.57045396e-03,
          4.57099211e-03,   4.56727587e-03,   1.54216191e-08,
          4.56865126e-03,   6.86588989e-04,   4.56795329e-03,
          4.28696678e-11,   2.40860723e-05,   2.43088083e-08,
          1.13399045e-04,   4.47336900e-03,   4.15211951e-06,
          4.55257403e-03,   4.20915625e-07,   4.57083855e-03,
          4.43217088e-03,   4.54036262e-06,   4.52502324e-03,
          4.56900412e-03,   1.08928383e-08,   1.94542524e-08],
       [  9.01491440e-11,   4.66635098e-07,   1.50115125e-04,
          5.49903766e-05,   7.79103380e-06,   2.51010757e-08,
          6.94690065e-02,   7.03220100e-02,   7.24796018e-02,
          7.24881360e-02,   7.24292028e-02,   2.44560566e-07,
          7.24510141e-02,   1.08881299e-02,   7.24399454e-02,
          6.79839789e-10,   3.81964012e-04,   3.85496225e-07,
          1.79831537e-03,   7.09400000e-02,   6.58455311e-05,
          7.21960567e-02,   6.67500366e-06,   7.24857008e-02,
          7.02866681e-02,   7.20024045e-05,   7.17591481e-02,
          7.24566099e-02,   1.72741830e-07,   3.08511250e-07],
       [  6.91277722e-11,   3.57823084e-07,   1.15110623e-04,
          4.21674801e-05,   5.97428645e-06,   1.92478970e-08,
          5.32699197e-02,   5.39240161e-02,   5.55784911e-02,
          5.55850354e-02,   5.55398444e-02,   1.87532864e-07,
          5.55565697e-02,   8.34918815e-03,   5.55480821e-02,
          5.21311773e-10,   2.92895972e-04,   2.95604529e-07,
          1.37897633e-03,   5.43979005e-02,   5.04913821e-05,
          5.53610644e-02,   5.11849710e-06,   5.55831680e-02,
          5.38969153e-02,   5.52125688e-05,   5.50260360e-02,
          5.55608606e-02,   1.32461135e-07,   2.36571247e-07],
       [  8.74426717e-12,   4.52625703e-08,   1.45608344e-05,
          5.33394466e-06,   7.55713011e-07,   2.43474871e-09,
          6.73833967e-03,   6.82107912e-03,   7.03036073e-03,
          7.03118854e-03,   7.02547214e-03,   2.37218329e-08,
          7.02758780e-03,   1.05612447e-03,   7.02651416e-03,
          6.59429528e-11,   3.70496626e-05,   3.73922795e-08,
          1.74432605e-04,   6.88102278e-03,   6.38687059e-06,
          7.00285749e-03,   6.47460561e-07,   7.03095233e-03,
          6.81765103e-03,   6.98407366e-06,   6.96047832e-03,
          7.02813057e-03,   1.67555747e-08,   2.99249075e-08],
       [  1.83974601e-10,   9.52299734e-07,   3.06351995e-04,
          1.12223280e-04,   1.58997886e-05,   5.12257817e-08,
          1.41770983e-01,   1.43511776e-01,   1.47914946e-01,
          1.47932363e-01,   1.47812093e-01,   4.99094396e-07,
          1.47856605e-01,   2.22202815e-02,   1.47834017e-01,
          1.38740368e-09,   7.79504646e-04,   7.86713118e-07,
          3.66996666e-03,   1.44772957e-01,   1.34376265e-04,
          1.47336293e-01,   1.36222162e-05,   1.47927393e-01,
          1.43439650e-01,   1.46941092e-04,   1.46444659e-01,
          1.47868025e-01,   3.52528131e-07,   6.29603694e-07],
       [  1.55706779e-10,   8.05978235e-07,   2.59280804e-04,
          9.49800967e-05,   1.34567753e-05,   4.33549057e-08,
          1.19987775e-01,   1.21461094e-01,   1.25187715e-01,
          1.25202455e-01,   1.25100665e-01,   4.22408204e-07,
          1.25138338e-01,   1.88061202e-02,   1.25119220e-01,
          1.17422816e-09,   6.59733229e-04,   6.65834115e-07,
          3.10607379e-03,   1.22528494e-01,   1.13729261e-04,
          1.24697972e-01,   1.15291535e-05,   1.25198249e-01,
          1.21400051e-01,   1.24363493e-04,   1.23943338e-01,
          1.25148003e-01,   2.98361945e-07,   5.32864660e-07],
       [  1.06254420e-11,   5.50000138e-08,   1.76933411e-05,
          6.48144876e-06,   9.18291334e-07,   2.95854194e-09,
          8.18797458e-03,   8.28851396e-03,   8.54281883e-03,
          8.54382472e-03,   8.53687854e-03,   2.88251668e-08,
          8.53944934e-03,   1.28333102e-03,   8.53814473e-03,
          8.01294158e-11,   4.50202439e-05,   4.54365688e-08,
          2.11958703e-04,   8.36135344e-03,   7.76089312e-06,
          8.50939875e-03,   7.86750279e-07,   8.54353769e-03,
          8.28434838e-03,   8.48657390e-06,   8.45790245e-03,
          8.54010888e-03,   2.03602410e-08,   3.63627235e-08],
       [  1.82636632e-10,   9.45374064e-07,   3.04124028e-04,
          1.11407128e-04,   1.57841562e-05,   5.08532384e-08,
          1.40739943e-01,   1.42468076e-01,   1.46839224e-01,
          1.46856514e-01,   1.46737119e-01,   4.95464695e-07,
          1.46781307e-01,   2.20586828e-02,   1.46758883e-01,
          1.37731368e-09,   7.73835641e-04,   7.80991689e-07,
          3.64327655e-03,   1.43720085e-01,   1.33399004e-04,
          1.46264779e-01,   1.35231477e-05,   1.46851580e-01,
          1.42396475e-01,   1.45872452e-04,   1.45379629e-01,
          1.46792644e-01,   3.49964344e-07,   6.25024855e-07],
       [  3.53111219e-18,   1.82779426e-14,   5.87995984e-12,
          2.15395489e-12,   3.05172220e-13,   9.83200841e-16,
          2.72107804e-09,   2.75448990e-09,   2.83900206e-09,
          2.83933634e-09,   2.83702794e-09,   9.57935660e-15,
          2.83788229e-09,   4.26484452e-10,   2.83744873e-09,
          2.66290999e-17,   1.49614041e-11,   1.50997598e-14,
          7.04394190e-11,   2.77869637e-09,   2.57914770e-12,
          2.82789569e-09,   2.61457688e-13,   2.83924095e-09,
          2.75310557e-09,   2.82031040e-12,   2.81078212e-09,
          2.83810147e-09,   6.76624042e-15,   1.20842838e-14]])]

3. 中間層〜入力層の逆伝播

        for l in xrange(2, self.num_layers):
            z = zs[-l]
            sp = sigmoid_prime(z)
            sp = sigmoid_prime(z)
            delta = np.dot(self.weights[-l+1].transpose(), delta) * sp
            nabla_b[-l] = delta
            nabla_w[-l] = np.dot(delta, activations[-l-1].transpose())
        return (nabla_b, nabla_w)

（１） z = zs[-2] （中間層Layer-2 　の重み付き出力）
[[ -5.3752867 ]
 [ 12.82540147]
 [  6.76637396]
 [ 10.69130276]
 [  4.14687668]
 [ 12.96073309]
 [ -4.19472294]
 [ 19.1240105 ]
 [ -3.76950136]
 [  7.19934245]
 [  5.3457037 ]
 [ -4.93064081]
 [ -1.25870567]
 [  2.75292192]
 [ -5.17228314]
 [ 10.30750889]
 [ -2.62832347]
 [  8.85898991]
 [ -0.48229116]
 [ -0.57839184]
 [  5.9026621 ]
 [ -1.49164962]
 [ -1.87117331]
 [  1.73879123]
 [ 11.14371248]
 [-18.21047578]
 [ -5.14823046]
 [  3.73135868]
 [  8.8179347 ]
 [  2.38544102]]
（２）　sp = sigmoid_prime(z) 
[[  2.16324823e-03]
 [  4.18792345e-05]
 [  2.90671720e-04]
 [  6.24624821e-02]
 [  2.47936113e-01]
 [  4.84628007e-06]
 [  4.93533498e-04]
 [  9.12406593e-08]
 [  4.98758193e-03]
 [  2.06726174e-10]
 [  2.32099068e-10]
 [  2.48014641e-01]
 [  1.20874282e-05]
 [  4.74300169e-06]
 [  4.69749338e-02]
 [  5.40798289e-07]
 [  1.06366902e-03]
 [  9.32039345e-04]
 [  1.13079678e-02]
 [  6.90811426e-05]
 [  6.79014198e-07]
 [  3.89782530e-06]
 [  1.77901684e-02]
 [  1.93783836e-11]
 [  3.34170101e-05]
 [  1.56832704e-03]
 [  5.91304113e-02]
 [  2.02199806e-05]
 [  2.15094239e-01]
 [  4.13599956e-06]]

（３）　delta = np.dot(self.weights[-l+1].transpose(), delta) * sp
   nabla_b[-l] = delta
[[ -1.71281287e-06]
 [ -1.94419415e-04]
 [  3.68164074e-06]
 [ -4.55136021e-03]
 [  4.13069592e-10]
 [  1.59128365e-04]
 [  5.09142329e-05]
 [ -6.61944696e-04]
 [ -3.20555030e-03]
 [  1.77790053e-03]
 [  2.14241805e-02]
 [  2.23398209e-05]
 [  2.53264026e-11]
 [  1.31094721e-02]
 [ -1.22558625e-05]
 [ -1.96735986e-12]
 [  1.20703320e-03]
 [ -4.17050689e-08]
 [ -2.57196207e-03]
 [  1.39462200e-05]
 [  3.36858057e-03]
 [  1.55452212e-13]
 [ -1.66131886e-06]
 [  4.09813642e-02]
 [  5.18074555e-12]
 [  2.12642263e-04]
 [  8.82046381e-03]
 [  2.73245815e-04]
 [  2.89622574e-07]
 [ -6.04619847e-03]]

（４）  nabla_w[-l] = np.dot(delta, activations[-l-1].transpose())
nabla_w =
[array([[ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       ..., 
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.]]), array([[  4.33474684e-02,   4.29050736e-02,   4.29895953e-02,
          2.07690743e-03,   5.68002077e-05,   2.53342992e-03,
          4.52132321e-07,   6.84415405e-04,   1.55989041e-02,
          4.33636724e-02,   8.76762936e-04,   4.31662288e-02,
          4.29681920e-02,   1.08090331e-02,   4.33627810e-02,
          1.46697160e-06,   1.34887639e-05,   2.26386084e-07,
          3.52612724e-03,   4.25039528e-02,   4.32718778e-02,
          4.33635513e-02,   3.48599300e-04,   1.43973170e-03,
          4.33198526e-02,   2.73806711e-02,   4.30204598e-02,
          3.81897021e-02,   8.12381787e-04,   2.59196026e-03],
       [  1.60186235e-04,   1.58551409e-04,   1.58863751e-04,
          7.67500371e-06,   2.09899488e-07,   9.36203693e-06,
          1.67080978e-09,   2.52918869e-06,   5.76441902e-05,
          1.60246115e-04,   3.23998976e-06,   1.59516482e-04,
          1.58784657e-04,   3.99437012e-05,   1.60242821e-04,
          5.42104686e-09,   4.98463781e-08,   8.36587135e-10,
          1.30304506e-05,   1.57069107e-04,   1.59906897e-04,
          1.60245668e-04,   1.28821386e-06,   5.32038452e-06,
          1.60084183e-04,   1.01182532e-04,   1.58977807e-04,
          1.41126225e-04,   3.00207566e-06,   9.57832996e-06],
       [  3.65893587e-02,   3.62159357e-02,   3.62872799e-02,
          1.75310609e-03,   4.79447416e-05,   2.13845420e-03,
          3.81642395e-07,   5.77711263e-04,   1.31669488e-02,
          3.66030364e-02,   7.40070752e-04,   3.64363754e-02,
          3.62692136e-02,   9.12384518e-03,   3.66022839e-02,
          1.23826263e-06,   1.13857911e-05,   1.91091243e-07,
          2.97638453e-03,   3.58773518e-02,   3.65255531e-02,
          3.66029342e-02,   2.94250744e-04,   1.21526957e-03,
          3.65660483e-02,   2.31118733e-02,   3.63133325e-02,
          3.22357166e-02,   6.85726979e-04,   2.18785934e-03],
       [  1.82823837e-08,   1.80957977e-08,   1.81314458e-08,
          8.75963922e-10,   2.39562592e-11,   1.06850849e-09,
          1.90692949e-13,   2.88661495e-10,   6.57904971e-09,
          1.82892180e-08,   3.69786679e-10,   1.82059434e-08,
          1.81224187e-08,   4.55885657e-09,   1.82888420e-08,
          6.18715202e-13,   5.68906941e-12,   9.54814063e-14,
          1.48719207e-09,   1.79266195e-08,   1.82505023e-08,
          1.82891669e-08,   1.47026491e-10,   6.07226402e-10,
          1.82707363e-08,   1.15481700e-08,   1.81444634e-08,
          1.61070257e-08,   3.42633055e-10,   1.09319445e-09],
       [  2.81550876e-03,   2.78677430e-03,   2.79226415e-03,
          1.34899483e-04,   3.68929233e-06,   1.64551574e-04,
          2.93669402e-08,   4.44542124e-05,   1.01318145e-03,
          2.81656125e-03,   5.69475870e-05,   2.80373687e-03,
          2.79087397e-03,   7.02069317e-04,   2.81650335e-03,
          9.52828746e-08,   8.76123435e-07,   1.47042498e-08,
          2.29029341e-04,   2.76072066e-03,   2.81059900e-03,
          2.81655338e-03,   2.26422539e-05,   9.35135859e-05,
          2.81371506e-03,   1.77843188e-03,   2.79426887e-03,
          2.48050105e-03,   5.27658967e-05,   1.68353242e-04],
       [  2.72292128e-03,   2.69513174e-03,   2.70044107e-03,
          1.30463338e-04,   3.56797063e-06,   1.59140326e-04,
          2.84012138e-08,   4.29923439e-05,   9.79863171e-04,
          2.72393915e-03,   5.50748762e-05,   2.71153651e-03,
          2.69909660e-03,   6.78981898e-04,   2.72388316e-03,
          9.21495150e-08,   8.47312278e-07,   1.42207032e-08,
          2.21497754e-04,   2.66993487e-03,   2.71817297e-03,
          2.72393155e-03,   2.18976676e-05,   9.04384090e-05,
          2.72118656e-03,   1.71994847e-03,   2.70237986e-03,
          2.39893023e-03,   5.10307000e-05,   1.62816977e-04],
       [  3.13609100e-02,   3.10408475e-02,   3.11019969e-02,
          1.50259541e-03,   4.10936618e-05,   1.83287907e-03,
          3.27107478e-07,   4.95159019e-04,   1.12854532e-02,
          3.13726333e-02,   6.34318095e-04,   3.12297873e-02,
          3.10865122e-02,   7.82009028e-03,   3.13719883e-02,
          1.06132067e-06,   9.75881467e-06,   1.63785196e-07,
          2.55107307e-03,   3.07506456e-02,   3.13062220e-02,
          3.13725457e-02,   2.52203686e-04,   1.04161322e-03,
          3.13409306e-02,   1.98092944e-02,   3.11243267e-02,
          2.76293831e-02,   5.87739794e-04,   1.87522445e-03],
       [  2.18438843e-02,   2.16209504e-02,   2.16635429e-02,
          1.04660611e-03,   2.86230594e-05,   1.27665933e-03,
          2.27840897e-07,   3.44894210e-04,   7.86068178e-03,
          2.18520499e-02,   4.41822990e-04,   2.17525531e-02,
          2.16527573e-02,   5.44694483e-03,   2.18516006e-02,
          7.39244044e-07,   6.79732883e-06,   1.14081666e-07,
          1.77690458e-03,   2.14188154e-02,   2.18057922e-02,
          2.18519888e-02,   1.75667993e-04,   7.25517169e-04,
          2.18299679e-02,   1.37978118e-02,   2.16790963e-02,
          1.92447555e-02,   4.09379703e-04,   1.30615425e-03],
       [ -1.16113029e-01,  -1.14928005e-01,  -1.15154409e-01,
         -5.56332401e-03,  -1.52148312e-04,  -6.78619148e-03,
         -1.21110771e-06,  -1.83331457e-03,  -4.17841240e-02,
         -1.16156434e-01,  -2.34854776e-03,  -1.15627550e-01,
         -1.15097077e-01,  -2.89536996e-02,  -1.16154046e-01,
         -3.92951473e-06,  -3.61317808e-05,  -6.06410820e-07,
         -9.44528777e-03,  -1.13853539e-01,  -1.15910547e-01,
         -1.16156109e-01,  -9.33778190e-04,  -3.85654835e-03,
         -1.16039055e-01,  -7.33434448e-02,  -1.15237085e-01,
         -1.02297138e-01,  -2.17609271e-03,  -6.94297423e-03],
       [  1.55446795e-02,   1.53860339e-02,   1.54163439e-02,
          7.44792291e-04,   2.03689179e-05,   9.08504177e-04,
          1.62137543e-07,   2.45435743e-04,   5.59386680e-03,
          1.55504904e-02,   3.14412798e-04,   1.54796858e-02,
          1.54086686e-02,   3.87618844e-03,   1.55501707e-02,
          5.26065401e-07,   4.83715702e-06,   8.11834980e-08,
          1.26449179e-03,   1.52421894e-02,   1.55175722e-02,
          1.55504469e-02,   1.25009939e-04,   5.16296998e-04,
          1.55347763e-02,   9.81888385e-03,   1.54274121e-02,
          1.36950715e-02,   2.91325306e-04,   9.29493532e-04]])]

4. 戻り値
（１）　nabla_b
[array([[  1.03131085e-06],
       [  1.27510653e-01],
       [ -1.01483366e-01],
       [ -6.64776801e-03],
       [  5.63235137e-03],
       [  1.37331832e-04],
       [  7.43464787e-02],
       [ -1.50573511e-06],
       [  1.71651627e-06],
       [ -5.02727088e-02],
       [ -4.25799815e-03],
       [  3.75249127e-03],
       [ -1.91314096e-03],
       [ -1.28625568e-02],
       [ -8.48516795e-06],
       [ -1.33005484e-04],
       [ -4.76867706e-07],
       [  3.60202610e-02],
       [  6.28859240e-04],
       [  9.99212551e-02],
       [  9.02190304e-03],
       [ -1.48909208e-05],
       [  5.19654893e-10],
       [ -9.86759332e-06],
       [ -9.45061171e-03],
       [ -1.33595205e-02],
       [ -1.07095754e-02],
       [ -2.59015337e-07],
       [  8.03858390e-06],
       [ -7.46059755e-03]]), array([[  1.44240292e-01],
       [  1.44828946e-01],
       [  1.43887059e-01],
       [  2.57372400e-03],
       [  4.14449375e-02],
       [  8.39694587e-04],
       [ -1.01224053e-01],
       [  1.10995742e-01],
       [  1.43656345e-01],
       [  2.15200091e-05]])]

（２）　nabla_w
array([[  1.65542465e-04,   5.78283859e-13,   7.77928888e-07,
          2.97627187e-12,   5.30963629e-08,   1.12332191e-04,
          3.75433069e-11,   8.75058590e-05,   1.62955057e-04,
          1.65541632e-04,   8.36473003e-05,   1.65542433e-04,
          3.07353459e-10,   1.45033416e-04,   1.48901414e-04,
          1.64962601e-04,   2.67091668e-06,   7.61490725e-05,
          1.50925665e-04,   1.44697662e-09,   4.64411315e-12,
          5.93874834e-06,   2.09565231e-11,   1.62775614e-04,
          9.09198793e-05,   2.11979450e-06,   1.65542467e-04,
          3.60328585e-12,   1.12051301e-06,   1.00723979e-04],
       [  1.44490991e-02,   5.04745461e-11,   6.79002308e-05,
          2.59778947e-10,   4.63442784e-06,   9.80472871e-03,
          3.27690518e-09,   7.63780355e-03,   1.42232615e-02,
          1.44490263e-02,   7.30101566e-03,   1.44490962e-02,
          2.68268361e-08,   1.26590008e-02,   1.29966126e-02,
          1.43984866e-02,   2.33126526e-04,   6.64654530e-03,
          1.31732960e-02,   1.26296950e-07,   4.05353702e-10,
          5.18353784e-04,   1.82915531e-09,   1.42075991e-02,
          7.93579064e-03,   1.85022742e-04,   1.44490993e-02,
          3.14506820e-10,   9.78021168e-05,   8.79152520e-03],
       [  7.59821794e-02,   2.65425961e-10,   3.57060845e-04,
          1.36607621e-09,   2.43706494e-05,   5.15592462e-02,
          1.72319669e-08,   4.01642315e-02,   7.47945877e-02,
          7.59817970e-02,   3.83931952e-02,   7.59821645e-02,
          1.41071873e-07,   6.65687502e-02,   6.83441191e-02,
          7.57160283e-02,   1.22592152e-03,   3.49515907e-02,
          6.92732284e-02,   6.64146428e-07,   2.13159710e-09,
          2.72582048e-03,   9.61881470e-09,   7.47122250e-02,
          4.17312294e-02,   9.72962471e-04,   7.59821804e-02,
          1.65386876e-09,   5.14303207e-04,   4.62312039e-02],
       [  1.11421881e-01,   3.89226265e-10,   5.23601604e-04,
          2.00324316e-09,   3.57376377e-05,   7.56075733e-02,
          2.52693222e-08,   5.88976818e-02,   1.09680371e-01,
          1.11421320e-01,   5.63005966e-02,   1.11421859e-01,
          2.06870790e-07,   9.76178287e-02,   1.00221267e-01,
          1.11031592e-01,   1.79771735e-03,   5.12537548e-02,
          1.01583733e-01,   9.73918423e-07,   3.12581925e-09,
          3.99720103e-03,   1.41052341e-08,   1.09559593e-01,
          6.11955608e-02,   1.42677283e-03,   1.11421883e-01,
          2.42526827e-09,   7.54185142e-04,   6.77944189e-02],
       [  1.42811079e-01,   4.98877083e-10,   6.71107950e-04,
          2.56758650e-09,   4.58054609e-05,   9.69073493e-02,
          3.23880654e-08,   7.54900333e-02,   1.40578960e-01,
          1.42810361e-01,   7.21613107e-02,   1.42811051e-01,
          2.65149364e-07,   1.25118220e-01,   1.28455086e-01,
          1.42310839e-01,   2.30416102e-03,   6.56926985e-02,
          1.30201379e-01,   1.24828570e-06,   4.00640895e-09,
          5.12327191e-03,   1.80788880e-08,   1.40424157e-01,
          7.84352589e-02,   1.82871592e-03,   1.42811081e-01,
          3.10850235e-09,   9.66650294e-04,   8.68931133e-02],
       [  2.59130761e-03,   9.05212669e-12,   1.21772565e-05,
          4.65888674e-11,   8.31140272e-07,   1.75838424e-03,
          5.87681577e-10,   1.36976696e-03,   2.55080580e-03,
          2.59129457e-03,   1.30936727e-03,   2.59130710e-03,
          4.81113627e-09,   2.27027061e-03,   2.33081806e-03,
          2.58223075e-03,   4.18090109e-05,   1.19199428e-03,
          2.36250454e-03,   2.26501491e-08,   7.26963064e-11,
          9.29617895e-05,   3.28041495e-10,   2.54799690e-03,
          1.42320809e-03,   3.31820576e-05,   2.59130764e-03,
          5.64037877e-11,   1.75398735e-05,   1.57667589e-03],
       [  1.35094628e-05,   4.71921466e-14,   6.34846253e-08,
          2.42885317e-13,   4.33304735e-09,   9.16711948e-06,
          3.06380546e-12,   7.14111117e-06,   1.32983116e-05,
          1.35093948e-05,   6.82622486e-06,   1.35094601e-05,
          2.50822658e-11,   1.18357760e-05,   1.21514326e-05,
          1.34621417e-05,   2.17966124e-07,   6.21431522e-06,
          1.23166262e-05,   1.18083760e-10,   3.78993232e-13,
          4.84644829e-07,   1.71020390e-12,   1.32836677e-05,
          7.41971992e-06,   1.72990567e-07,   1.35094630e-05,
          2.94054194e-13,   9.14419682e-08,   8.21980539e-06],
       [  7.37806202e-04,   2.57735330e-12,   3.46715122e-06,
          1.32649459e-11,   2.36645177e-07,   5.00653336e-04,
          1.67326762e-10,   3.90004858e-04,   7.26274386e-04,
          7.37802489e-04,   3.72807648e-04,   7.37806058e-04,
          1.36984361e-09,   6.46399421e-04,   6.63638703e-04,
          7.35221808e-04,   1.19040084e-05,   3.39388797e-04,
          6.72660589e-04,   6.44902999e-09,   2.06983476e-11,
          2.64684071e-05,   9.34011264e-11,   7.25474623e-04,
          4.05220805e-04,   9.44771197e-06,   7.37806212e-04,
          1.60594845e-11,   4.99401437e-06,   4.48916696e-04],
       [  1.15252642e-01,   4.02608132e-10,   5.41603387e-04,
          2.07211604e-09,   3.69663223e-05,   7.82070136e-02,
          2.61380988e-08,   6.09226246e-02,   1.13451258e-01,
          1.15252062e-01,   5.82362498e-02,   1.15252619e-01,
          2.13983150e-07,   1.00973997e-01,   1.03666943e-01,
          1.14848934e-01,   1.85952411e-03,   5.30158941e-02,
          1.05076251e-01,   1.00740241e-06,   3.23328706e-09,
          4.13462755e-03,   1.45901817e-08,   1.13326327e-01,
          6.32995063e-02,   1.47582626e-03,   1.15252643e-01,
          2.50865066e-09,   7.80114545e-04,   7.01252376e-02],
       [ -5.08965688e-03,  -1.77795252e-11,  -2.39176765e-05,
         -9.15064460e-11,  -1.63246493e-06,  -3.45368973e-03,
         -1.15428117e-09,  -2.69039608e-03,  -5.01010620e-03,
         -5.08963127e-03,  -2.57176343e-03,  -5.08965589e-03,
         -9.44968198e-09,  -4.45909950e-03,  -4.57802236e-03,
         -5.07182879e-03,  -8.21182014e-05,  -2.34122798e-03,
         -4.64025863e-03,  -4.44877663e-08,  -1.42784768e-10,
         -1.82588748e-04,  -6.44315113e-10,  -5.00458915e-03,
         -2.79536124e-03,  -6.51737708e-05,  -5.08965695e-03,
         -1.10784195e-10,  -3.44505367e-05,  -3.09679147e-03]])]

\end{verbatim}






\end{document}